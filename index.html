<!doctype html>
<html lang="it">
  <head>
    <title>Boolzapp</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="icon" href="./assets/img/ic-boolzapp.png">
    <script src="https://kit.fontawesome.com/09495c5fdc.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css"  integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <link rel="stylesheet" href="./assets/style.css">
    <link id="favicon" rel="shortcut icon" type="image/png" href="/img/favicon_c5088e888c97ad440a61d247596f88e5.png" src="/img/favicon_c5088e888c97ad440a61d247596f88e5.png">

  </head>
  <body>
    
    <div id="app">
        <div class="container h_100 d-flex justify-content-center align-items-center">
            <div class="view d-flex w-100 h_100 p-3">
                <div class="users d-flex flex-column flex-grow-1">
                    <header class="px-1 py-1 d-flex align-items-center bg-gray">

                        <img class="img_height rounded-circle c-pointer" src="./assets/img/avatar_io.jpg" alt="my img profile">
                        <div class="flex-grow-1 fs-7 fw-semibold d-flex align-items-center"> Sofia </div>

                        <div class="me_buttons d-flex gap-1">
                            <i class="c-pointer hover color-gray px-1 fa-solid fa-circle-notch"></i>
                            <i class="c-pointer hover color-gray px-1 fa-solid fa-message"></i>
                            <i class="c-pointer hover color-gray px-2 fa-solid fa-ellipsis-vertical"></i>
                        </div>

                    </header>
                    <div class="notifications my-bg-white">

                        <div class="top px-1 py-2 d-flex gap-2 align-items-center">

                            <i class="d-flex justify-content-center align-items-center rounded-circle square p-2 bg-white c-pointer fa-solid fa-bell-slash"></i>
                            <div class="paragraphs d-flex flex-column">
                                <p class="m-0 fs-7 fw-semibold">Ricevi notifiche di nuovi messaggi</p>
                                <a class="m-0 fs-8 link-dark hover-white" href="#nogo">Attiva notifiche desktop</a>
                            </div>

                        </div>

                        <div class="bottom bg-white m-1 d-flex align-items-center border">

                            <button class="fs-7 color-gray d-flex no-border h-100 width-search justify-content-center align-items-center btn rounded-0">
                                <i @click="search_icons" :class="search_icon"></i>
                            </button>

                            <input @click="search_focus" @blur="search_blur" ref="bar_search" v-model="search" class="no-focus-visible w-100 h-100 fs-7 py-1 no-border fw-semibold" type="text" placeholder="Cerca o inizia una nuova chat">
                        </div>

                    </div>

                    <nav class="flex-grow-1 py-1 overflow-auto">
                        <ul class="list-unstyled">
                            <template v-for="(user, index) in contacts">

                                <li v-if="user.name.toLowerCase().includes( search )" class="position-relative px-3 c-pointer hover_bg d-flex align-items-center hei py-2 gap-3" 
                                    :key="index" 
                                    @click="select_user( index )">

                                        <img class="img_height rounded-circle square img-fluid" :src="`./assets/img/avatar${user.avatar}.jpg`" :alt="user.name">
                                        <div class="ms-auto me-auto flex-grow-1">
                                            <p class="m-0 fs-7 fw-semibold"> {{ user.name }} </p>
                                            <p class="m-0 fs-8 color-gray pb-2"> Ultimo messaggio inviato </p>
                                        </div>
                                        <div class="date_envoy fs-8 color-gray position-absolute    top-0 right-0 me-2 mt-2">
                                            {{ last_time_received( user ) }}
                                        </div>
                                </li>

                            </template>
                        </ul>
                    </nav>
                </div>
                
                <div class="chat flex-grow-2 d-flex flex-column">
                    <header class="px-1 py-1 d-flex align-items-center bg-gray border-start">

                        <img class="img_height rounded-circle square img-fluid" :src="`./assets/img/avatar_${user_select+1}.jpg`" :alt="contacts[user_select].name">
                        <div class="ms-2 me-auto flex-grow-1">
                            <p class="m-0 fs-7 fw-semibold"> {{ contacts[user_select].name }} </p>
                            <p class="m-0 fs-8 color-gray"> {{ action_users }} </p>
                        </div>

                        <div class="me_buttons d-flex gap-1">
                            <i class="c-pointer hover color-gray px-1 fa-solid fa-magnifying-glass"></i>
                            <i class="c-pointer hover color-gray px-1 fa-solid fa-paperclip"></i>
                            <i class="c-pointer hover color-gray px-2 fa-solid fa-ellipsis-vertical"></i>
                        </div> 

                    </header>

                    <main id="chat" class="overflow-auto flex-grow-1 bg-chat pb-4">
                        <ul class="list-unstyled d-flex flex-column gap-2 p-3">
                            <template v-for="(message, i) in messages[user_select]">

                                <li :class="status(message, i)" 
                                    class="rounded-2 fs-8 fw-semibold position-relative w-50 mx-3 max-width d-flex justify-content-between" 
                                    :key="i">

                                        <p class="white-space m-2 mb-3 line-height-75" v-html="message.message"></p>

                                        <div class="d-flex flex-column justify-content-between">
                                            <div class="d-flex justify-content-center align-items-center p-1 position-relative">
                                                <i class="fa-solid fa-chevron-down c-pointer" @click="close_drop_menu(message, true)"></i>

                                                <div class="bg-white position-absolute top-100 right-0 z-index-1 my-w-150 px-1 shadow border p-1" v-if="message.drop_menu === true" @mouseleave="close_drop_menu(message, false)">
                                                    
                                                    <p class="my-0 hover_bg c-pointer p-1" @click="close_drop_menu(message, false)">Info messaggio</p>
                                                    <p class="my-0 hover_bg c-pointer p-1" @click="close_drop_menu(message, false)">Elimina messaggio</p>
                                                </div>

                                            </div>
                                            <div class="time_message color-gray fs-9 p-1">
                                                {{ message.date.slice(11, 16) }}
                                            </div>
                                        </div>
                                </li>

                            </template>
                        </ul>
                    </main>

                    <div class="px-1 py-1 d-flex align-items-center bg-gray border-start">
                        
                        <div class="me_buttons d-flex gap-1" @click="add_emoticon">
                            <i class="px-3 c-pointer hover color-gray fa-solid fa-face-smile"></i>
                        </div>
                            
                        <input class="resize-none fw-semibold flex-grow-1 fs-7 no-focus-visible input-group border rounded-1 p-2" @keypress.enter="click_push_message(user_select, 'sent')" cols="1" rows="1" v-model="sent_message" type="text" placeholder="Scrivi un messaggio" ref="message_sent">

                        <div class="me_buttons d-flex gap-1" @click="click_push_message(user_select, 'sent')">
                            <i :class="sent_button" class="px-3 c-pointer hover color-gray"></i>
                        </div> 

                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="./assets/vue.js"></script>

  </body>
</html>